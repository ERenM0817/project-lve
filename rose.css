:root {
  --bg-night: radial-gradient(circle at top, #171829 0%, #050513 55%, #010109 100%);
  --bg-dawn: radial-gradient(circle at top, #ffe5f3 0%, #ffeef9 33%, #ffd6ec 66%, #f3c8ff 100%);
  --rose-red: #ff1f4b;
  --rose-red-deep: #a0042c;
  --rose-highlight: #ff8aa7;
  --leaf-green: #149f63;
  --leaf-highlight: #59f2a4;
  --stem-green: #0f7b4b;
  --light-gold: #ffdca0;
  --orbit: rgba(255, 210, 240, 0.7);
  --transition-duration: 1.6s;
}

*,
*::before,
*::after {
  box-sizing: border-box;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
  background: #050513;
  color: #fdf2f8;
}

.app {
  position: relative;
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  background: var(--bg-night);
  transition: background var(--transition-duration) ease;
}

.app.bloomed {
  background: var(--bg-dawn);
}

.night-sky {
  pointer-events: none;
  position: absolute;
  inset: 0;
  background:
    radial-gradient(circle at 10% 15%, rgba(255, 255, 255, 0.45) 0, transparent 55%),
    radial-gradient(circle at 80% 10%, rgba(209, 213, 255, 0.4) 0, transparent 60%),
    radial-gradient(circle at 20% 75%, rgba(244, 114, 182, 0.36) 0, transparent 55%),
    radial-gradient(circle at 95% 80%, rgba(129, 140, 248, 0.35) 0, transparent 55%);
  mix-blend-mode: screen;
  opacity: 0.32;
  transition: opacity var(--transition-duration) ease;
}

.app.bloomed .night-sky {
  opacity: 0.16;
}

.scene {
  position: relative;
  width: 100%;
  max-width: 480px;
  aspect-ratio: 9 / 16;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  padding: 9vh 1.6rem 3.6rem;
  z-index: 0; /* base layer for background effects */
}

@media (min-width: 768px) {
  .scene {
    max-width: 520px;
    aspect-ratio: 9 / 19.5;
    padding-top: 7vh;
  }
}

.valentine-header {
  position: relative;
  text-align: center;
  margin-bottom: 1.7rem;
  color: #4b1430;
  text-shadow: 0 3px 8px rgba(0, 0, 0, 0.55);
  z-index: 2; /* above falling background */
  opacity: 0;
  transform: translateY(-10px);
  transition:
    opacity 0.9s ease,
    transform 0.9s ease;
}

.valentine-header.visible {
  opacity: 1;
  transform: translateY(0);
}

.valentine-title {
  font-weight: 700;
  font-size: 1.4rem;
  letter-spacing: 0.18em;
  text-transform: uppercase;
}

.valentine-subtitle {
  margin-top: 0.35rem;
  font-size: 0.9rem;
  letter-spacing: 0.14em;
  text-transform: uppercase;
  opacity: 0.9;
}

.valentine-header::before,
.valentine-header::after {
  content: "â™¥";
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  font-size: 1rem;
  color: rgba(239, 68, 138, 0.9);
}

.valentine-header::before {
  left: 5%;
}

.valentine-header::after {
  right: 5%;
}

.rose-wrapper {
  position: relative;
  flex: 1;
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 2; /* keep rose above falling background */
}

.light-orbit {
  pointer-events: none;
  position: absolute;
  width: 56%;
  max-width: 260px;
  aspect-ratio: 3 / 1;
  border-radius: 50%;
  background:
    radial-gradient(circle at 50% 40%, rgba(255, 255, 255, 0.3), transparent 70%),
    radial-gradient(circle at 20% 40%, rgba(244, 114, 182, 0.4), transparent 70%),
    radial-gradient(circle at 80% 40%, rgba(129, 140, 248, 0.35), transparent 70%);
  opacity: 0.16;
  filter: blur(6px);
  transform: translateY(40px) scale(0.9);
  transition:
    opacity var(--transition-duration) ease,
    transform var(--transition-duration) ease;
}

.app.blooming .light-orbit,
.app.bloomed .light-orbit {
  opacity: 0.5;
  transform: translateY(35px) scale(1);
}

.rose {
  position: relative;
  width: 46vw;
  max-width: 240px;
  aspect-ratio: 3 / 5;
  transform-origin: center bottom;
  transform: translateY(24px) scale(0.9);
  cursor: pointer;
  transition:
    transform var(--transition-duration) cubic-bezier(0.16, 1, 0.3, 1),
    filter var(--transition-duration) ease;
  filter: brightness(0.78) saturate(0.95);
}

@media (min-width: 768px) {
  .rose {
    width: 34vw;
    max-width: 240px;
  }
}

.app.blooming .rose {
  animation: rose-sway-once 1.6s ease-out forwards;
}

.app.bloomed .rose {
  transform: translateY(10px) scale(1.02);
  filter: brightness(1.05) saturate(1.18);
}

@keyframes rose-sway-once {
  0% {
    transform: translateY(24px) scale(0.9) rotate(0deg);
  }
  35% {
    transform: translateY(15px) scale(1.02) rotate(-1.4deg);
  }
  70% {
    transform: translateY(9px) scale(1.04) rotate(0.8deg);
  }
  100% {
    transform: translateY(10px) scale(1.02) rotate(0deg);
  }
}

.stem {
  position: absolute;
  bottom: 3%;
  left: 50%;
  width: 12px;
  height: 58%;
  transform: translateX(-50%);
  background:
    linear-gradient(to right, rgba(0, 0, 0, 0.45), transparent 30%, rgba(255, 255, 255, 0.3)),
    linear-gradient(to top, #064e3b 0, var(--stem-green) 60%, #16a34a 100%);
  border-radius: 999px;
  box-shadow:
    0 0 4px rgba(16, 185, 129, 0.4),
    0 12px 18px rgba(0, 0, 0, 0.7);
  transform-origin: bottom center;
}

.app.blooming .stem,
.app.bloomed .stem {
  animation: stem-bend-once var(--transition-duration) ease-out forwards;
}

@keyframes stem-bend-once {
  0% {
    transform: translateX(-50%) rotate(0deg);
  }
  40% {
    transform: translateX(-50%) rotate(-3deg);
  }
  100% {
    transform: translateX(-50%) rotate(-1deg);
  }
}

.leaf {
  position: absolute;
  bottom: 27%;
  width: 64px;
  height: 92px;
  background: radial-gradient(circle at 20% 20%, var(--leaf-highlight), var(--leaf-green));
  border-radius: 0 100% 50% 100%;
  transform-origin: bottom center;
  opacity: 0;
  transform: scale(0.3) rotate(0deg);
  filter: drop-shadow(0 8px 9px rgba(0, 0, 0, 0.56));
  transition:
    opacity var(--transition-duration) ease,
    transform var(--transition-duration) cubic-bezier(0.19, 0.7, 0.3, 1.2);
}

.leaf-left {
  left: 20%;
  transform-origin: bottom right;
}

.leaf-right {
  left: 33%;
  transform-origin: bottom left;
}

.app.blooming .leaf,
.app.bloomed .leaf {
  opacity: 1;
}

.app.blooming .leaf-left,
.app.bloomed .leaf-left {
  transform: scale(1) rotate(-37deg);
  transition-delay: 0.22s;
}

.app.blooming .leaf-right,
.app.bloomed .leaf-right {
  transform: scale(1) rotate(50deg);
  transition-delay: 0.28s;
}

.rose-glow {
  position: absolute;
  bottom: 52%;
  left: 50%;
  width: 170px;
  height: 170px;
  transform: translate(-50%, 0);
  border-radius: 50%;
  background:
    radial-gradient(circle at 50% 25%, rgba(255, 255, 255, 0.65), transparent 60%),
    radial-gradient(circle at 30% 50%, rgba(248, 113, 166, 0.55), transparent 65%),
    radial-gradient(circle at 70% 70%, rgba(248, 250, 252, 0.45), transparent 70%);
  mix-blend-mode: screen;
  opacity: 0.2;
  filter: blur(6px);
  transition:
    opacity var(--transition-duration) ease,
    transform var(--transition-duration) ease,
    filter var(--transition-duration) ease;
}

.app.blooming .rose-glow {
  opacity: 0.75;
  filter: blur(7px);
  transform: translate(-50%, -4px) scale(1.02);
}

.app.bloomed .rose-glow {
  opacity: 0.9;
  filter: blur(4px);
  transform: translate(-50%, -6px) scale(1.06);
}

.rose-center {
  position: absolute;
  bottom: 59%;
  left: 50%;
  width: 42px;
  height: 42px;
  transform: translate(-50%, 0) scale(0.8);
  border-radius: 50%;
  background: radial-gradient(circle at 30% 20%, #ffe5ec, var(--rose-red) 55%, var(--rose-red-deep) 100%);
  box-shadow:
    0 0 12px rgba(248, 113, 166, 0.8),
    0 0 28px rgba(248, 250, 252, 0.9);
  opacity: 0.9;
  transition:
    transform var(--transition-duration) cubic-bezier(0.2, 0.7, 0.3, 1.15),
    box-shadow var(--transition-duration) ease;
}

.app.blooming .rose-center,
.app.bloomed .rose-center {
  transform: translate(-50%, 0) scale(1.02);
  box-shadow:
    0 0 16px rgba(248, 113, 166, 0.95),
    0 0 40px rgba(252, 231, 243, 1);
}

.petal {
  position: absolute;
  bottom: 58%;
  left: 50%;
  width: 80px;
  height: 110px;
  transform-origin: bottom center;
  border-radius: 60% 60% 45% 45%;
  background: radial-gradient(circle at 30% 20%, var(--rose-highlight), var(--rose-red) 60%, var(--rose-red-deep) 100%);
  box-shadow:
    inset 0 -10px 16px rgba(190, 24, 93, 0.8),
    0 10px 18px rgba(0, 0, 0, 0.76);
  opacity: 0;
  transform: translateX(-50%) translateY(12px) scaleY(0.1) scaleX(0.2) rotate(0deg);
  transition:
    opacity var(--transition-duration) ease,
    transform var(--transition-duration) cubic-bezier(0.25, 0.7, 0.35, 1.3);
}

.petal-inner {
  width: 64px;
  height: 86px;
  bottom: 60%;
}

.petal-mid {
  width: 84px;
  height: 110px;
}

.petal-outer {
  width: 100px;
  height: 124px;
}

.app.blooming .petal,
.app.bloomed .petal {
  opacity: 1;
}

.app.blooming .petal-inner.petal-1,
.app.bloomed .petal-inner.petal-1 {
  transform: translateX(-50%) translateY(0) scaleY(1) scaleX(1) rotate(-6deg);
  transition-delay: 0.06s;
}

.app.blooming .petal-inner.petal-2,
.app.bloomed .petal-inner.petal-2 {
  transform: translateX(-50%) translateY(0) scaleY(1) scaleX(1) rotate(0deg);
  transition-delay: 0.12s;
}

.app.blooming .petal-inner.petal-3,
.app.bloomed .petal-inner.petal-3 {
  transform: translateX(-50%) translateY(0) scaleY(1) scaleX(1) rotate(6deg);
  transition-delay: 0.18s;
}

.app.blooming .petal-mid.petal-4,
.app.bloomed .petal-mid.petal-4 {
  transform: translateX(calc(-50% - 16px)) translateY(4px) scaleY(1) scaleX(1) rotate(-18deg);
  transition-delay: 0.22s;
}

.app.blooming .petal-mid.petal-5,
.app.bloomed .petal-mid.petal-5 {
  transform: translateX(calc(-50% - 4px)) translateY(-2px) scaleY(1.02) scaleX(1) rotate(-4deg);
  transition-delay: 0.26s;
}

.app.blooming .petal-mid.petal-6,
.app.bloomed .petal-mid.petal-6 {
  transform: translateX(calc(-50% + 4px)) translateY(-2px) scaleY(1.02) scaleX(1) rotate(4deg);
  transition-delay: 0.3s;
}

.app.blooming .petal-mid.petal-7,
.app.bloomed .petal-mid.petal-7 {
  transform: translateX(calc(-50% + 16px)) translateY(4px) scaleY(1) scaleX(1) rotate(18deg);
  transition-delay: 0.34s;
}

.app.blooming .petal-outer.petal-8,
.app.bloomed .petal-outer.petal-8 {
  transform: translateX(calc(-50% - 24px)) translateY(8px) scaleY(1.02) scaleX(1) rotate(-26deg);
  transition-delay: 0.38s;
}

.app.blooming .petal-outer.petal-9,
.app.bloomed .petal-outer.petal-9 {
  transform: translateX(calc(-50% - 8px)) translateY(2px) scaleY(1.05) scaleX(1) rotate(-12deg);
  transition-delay: 0.42s;
}

.app.blooming .petal-outer.petal-10,
.app.bloomed .petal-outer.petal-10 {
  transform: translateX(calc(-50% + 8px)) translateY(2px) scaleY(1.05) scaleX(1) rotate(12deg);
  transition-delay: 0.46s;
}

.app.blooming .petal-outer.petal-11,
.app.bloomed .petal-outer.petal-11 {
  transform: translateX(calc(-50% + 24px)) translateY(8px) scaleY(1.02) scaleX(1) rotate(26deg);
  transition-delay: 0.5s;
}

.hint {
  position: absolute;
  bottom: 7%;
  left: 50%;
  transform: translateX(-50%);
  font-size: 0.9rem;
  letter-spacing: 0.09em;
  text-transform: uppercase;
  color: rgba(248, 250, 252, 0.8);
  text-shadow: 0 2px 4px rgba(15, 23, 42, 0.95);
  opacity: 0.9;
  animation: hint-pulse 1.5s ease-in-out infinite alternate;
  pointer-events: none;
}

.app.bloomed .hint {
  opacity: 0;
  animation: none;
}

@keyframes hint-pulse {
  from {
    transform: translateX(-50%) translateY(0);
    opacity: 0.55;
  }
  to {
    transform: translateX(-50%) translateY(-4px);
    opacity: 0.95;
  }
}

body.initial-dark {
  background: #050513;
}

/* Falling hearts & petals background after bloom */
.scene::before,
.scene::after {
  content: "";
  position: absolute;
  /* extend slightly beyond the viewport to hide the pattern seam */
  inset: -48px;
  pointer-events: none;
  opacity: 0;
  mix-blend-mode: screen;
  background-repeat: repeat;
  /* taller tiles so the top edge of the pattern starts offscreen */
  background-size: 160px 340px;
  will-change: background-position;
  transition: opacity 1.2s ease;
  z-index: -1; /* behind rose and header */
}

/* Hearts layer */
.scene::before {
  background-image:
    radial-gradient(circle at 20% 0%, rgba(248, 113, 166, 0.78) 0, rgba(248, 113, 166, 0.78) 6px, transparent 8px),
    radial-gradient(circle at 40% -10%, rgba(244, 63, 94, 0.9) 0, rgba(244, 63, 94, 0.9) 7px, transparent 9px),
    radial-gradient(circle at 80% 0%, rgba(251, 113, 133, 0.85) 0, rgba(251, 113, 133, 0.85) 5px, transparent 7px),
    radial-gradient(circle at 10% 40%, rgba(244, 114, 182, 0.85) 0, rgba(244, 114, 182, 0.85) 6px, transparent 8px),
    radial-gradient(circle at 70% 50%, rgba(244, 63, 94, 0.9) 0, rgba(244, 63, 94, 0.9) 5px, transparent 7px);
}

/* Petals layer */
.scene::after {
  background-image:
    radial-gradient(circle at 10% 0%, rgba(254, 226, 226, 0.9) 0, rgba(254, 226, 226, 0.9) 4px, transparent 6px),
    radial-gradient(circle at 50% -10%, rgba(252, 231, 243, 0.9) 0, rgba(252, 231, 243, 0.9) 5px, transparent 7px),
    radial-gradient(circle at 90% 0%, rgba(251, 207, 232, 0.95) 0, rgba(251, 207, 232, 0.95) 4px, transparent 7px),
    radial-gradient(circle at 30% 50%, rgba(255, 228, 230, 0.9) 0, rgba(255, 228, 230, 0.9) 5px, transparent 7px),
    radial-gradient(circle at 80% 60%, rgba(254, 202, 232, 0.95) 0, rgba(254, 202, 232, 0.95) 4px, transparent 7px);
}

.app.bloomed .scene::before,
.app.blooming .scene::before {
  opacity: 0.85;
  animation: fall-hearts 14s linear infinite;
}

.app.bloomed .scene::after,
.app.blooming .scene::after {
  opacity: 0.7;
  animation: fall-petals 30s linear infinite;
}

@keyframes fall-hearts {
  0% {
    /* start one tile at the top */
    background-position: 0 0;
  }
  100% {
    /* move down exactly one tile height to loop seamlessly */
    background-position: 0 340px;
  }
}

@keyframes fall-petals {
  0% {
    /* slight horizontal offset so petals don't align with hearts */
    background-position: 40px 0;
  }
  100% {
    background-position: 40px 340px;
  }
}

/* Subtle sway for selected petals after full bloom */
@keyframes petal-sway-left-soft {
  0% {
    transform: translateX(calc(-50% - 24px)) translateY(8px) scaleY(1.02) scaleX(1) rotate(-26deg);
  }
  100% {
    transform: translateX(calc(-50% - 26px)) translateY(10px) scaleY(1.02) scaleX(1.02) rotate(-22deg);
  }
}

@keyframes petal-sway-right-soft {
  0% {
    transform: translateX(calc(-50% + 24px)) translateY(8px) scaleY(1.02) scaleX(1) rotate(26deg);
  }
  100% {
    transform: translateX(calc(-50% + 26px)) translateY(6px) scaleY(1.02) scaleX(1.02) rotate(22deg);
  }
}

@keyframes petal-sway-mid-soft {
  0% {
    transform: translateX(calc(-50% - 4px)) translateY(-2px) scaleY(1.02) scaleX(1) rotate(-4deg);
  }
  100% {
    transform: translateX(calc(-50% - 2px)) translateY(-1px) scaleY(1.04) scaleX(1.01) rotate(-1deg);
  }
}

.app.bloomed .petal-mid.petal-5 {
  animation: petal-sway-mid-soft 7.5s ease-in-out infinite alternate;
  animation-delay: -3s;
}

.app.bloomed .petal-outer.petal-8 {
  animation: petal-sway-left-soft 9s ease-in-out infinite alternate;
  animation-delay: -4s;
}

.app.bloomed .petal-outer.petal-11 {
  animation: petal-sway-right-soft 11s ease-in-out infinite alternate;
  animation-delay: -6s;
}

